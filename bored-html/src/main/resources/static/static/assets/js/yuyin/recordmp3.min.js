window.MP3Recorder=function(e){function a(a){e.debug&&console.log(a)}var t=this;(e=e||{}).sampleRate=e.sampleRate||44100,e.bitRate=e.bitRate||128,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({audio:!0},function(n){var r,o,i=new AudioContext,s=i.createMediaStreamSource(n),c=i.createScriptProcessor(16384,1,1);e.sampleRate=i.sampleRate,c.onaudioprocess=function(e){var a=e.inputBuffer.getChannelData(0);d.postMessage({cmd:"encode",buf:a})};var d=new Worker("static/assets/js/yuyin/worker-realtime.min.js");d.onmessage=function(t){switch(t.data.cmd){case"init":e.funOk&&e.funOk();break;case"end":a("MP3大小：",t.data.buf.length),r&&r(new Blob(t.data.buf,{type:"audio/mp3"}));break;case"error":a("错误信息："+t.data.error),o&&o(t.data.error);break;default:a("未知信息：",t.data)}},t.getMp3Blob=function(e,a){o=a,r=e,d.postMessage({cmd:"finish"})},t.start=function(){c&&s&&(s.connect(c),c.connect(i.destination),a("开始录音"))},t.stop=function(){c&&s&&(s.disconnect(),c.disconnect(),a("录音结束"))},d.postMessage({cmd:"init",config:{sampleRate:e.sampleRate,bitRate:e.bitRate}})},function(a){var t;switch(a.code||a.name){case"PERMISSION_DENIED":case"PermissionDeniedError":t="用户拒绝访问麦客风";break;case"NOT_SUPPORTED_ERROR":case"NotSupportedError":t="浏览器不支持麦客风";break;case"MANDATORY_UNSATISFIED_ERROR":case"MandatoryUnsatisfiedError":t="找不到麦客风设备";break;default:t="无法打开麦克风，异常信息:"+(a.code||a.name)}e.funCancel&&e.funCancel(t)}):e.funCancel&&e.funCancel("当前浏览器不支持录音功能")};