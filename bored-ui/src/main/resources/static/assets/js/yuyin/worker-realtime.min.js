!function(){"use strict";importScripts("lame.min.js");var n,e,a,t,r,s=function(){r=[]},i=function(n){r.push(new Int8Array(n))},c=function(e){t=e||{},a=new lamejs,n=new a.Mp3Encoder(1,t.sampleRate||44100,t.bitRate||128),s(),self.postMessage({cmd:"init"})},f=function(n,e){for(var a=0;a<n.length;a++){var t=Math.max(-1,Math.min(1,n[a]));e[a]=t<0?32768*t:32767*t}},o=function(n){var e=new Float32Array(n),a=new Int16Array(n.length);return f(e,a),a},u=function(a){for(var t=(e=o(a)).length,r=0;t>=0;r+=1152){var s=e.subarray(r,r+1152),c=n.encodeBuffer(s);i(c),t-=1152}},l=function(){i(n.flush()),self.postMessage({cmd:"end",buf:r}),s()};self.onmessage=function(n){switch(n.data.cmd){case"init":c(n.data.config);break;case"encode":u(n.data.buf);break;case"finish":l()}}}();